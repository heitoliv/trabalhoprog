import pickle

with open('usuarios.bin', 'rb') as arq:
    dic = pickle.load(arq)

# comparação de cada logins e os criterios estabelecidos
def criteriosMaior(dic, i, j):
    #quantidade de seguidores de cada usuário (primeiro critério)
    seguidores_posI = len(dic[i][2])
    seguidores_posJ = len(dic[j][2])

    #quantidade de seguindo de cada usuário (segundo critério)
    seguindo_posI = len(dic[i][1])
    seguindo_posJ = len(dic[j][1])

    #dados em relação aos nome ao critério de desempate - ordem alfabetica (terceiro critério)
    nome_posI = dic[i][0]
    nome_posJ = dic[j][0]
    # print(i,j)
    # print(seguidores_posI, seguidores_posJ)
    # print(seguidores_posJ, seguindo_posJ)
    # print(nome_posI, nome_posJ)
    #primeiro critério
    if seguidores_posI > seguidores_posJ:
        return True
    if seguidores_posI < seguidores_posJ:
        return False
    
    #segundo critério
    if seguindo_posI > seguindo_posJ:
        return True
    if seguindo_posI < seguindo_posJ:
        return False
    
    #terceiro critério
    if nome_posI < nome_posJ:
        return True
    if nome_posI > nome_posJ:
        return False 
    return i < j 

#função auxiliar para a implementação do algoritmo do merge sort
def merge(l, lEsq, lDir):
    i = 0
    j = 0
    k = 0
    while i < len(lEsq) and j < len(lDir):
        if criteriosMaior(dic,lEsq[i],lDir[j]):
            l[k] = lEsq[i]
            i += 1
        else:
            l[k] = lDir[j]
            j += 1
        k += 1

    while i < len(lEsq):
        l[k] = lEsq[i]
        i += 1
        k += 1

    while j < len(lDir):
        l[k] = lDir[j]
        j += 1
        k += 1

#algoritmo de ordenação merge sort
def mergeSort(l):
    if len(l) > 1:
        meio = len(l) // 2
        lEsq = l[:meio]
        lDir = l[meio:]

        mergeSort(lEsq)
        mergeSort(lDir)

        merge(l, lEsq, lDir)
    return l

#criação e ordenação da lista de logins
def Lista_logins(dic):
    l_login = []
    for chave in dic:
        l_login.append(chave)
    listaOrdenada = mergeSort(l_login)
    return listaOrdenada

def formatPrint(dic, l):
    for login in l:
        nome = dic[login][0]
        num_Seguindo = len(dic[login][1])
        num_Seguidores = len(dic[login][2])
        print(f'{nome} (segue {num_Seguindo}, seguido por {num_Seguidores})')

def main():
    lista = Lista_logins(dic)
    formatPrint(dic, lista)
main()
